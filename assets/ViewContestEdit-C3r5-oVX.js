import{e as M,u as R,p as c,q as Y,r as g,s as C,o as v,v as e,w as a,k as t,C as y,D,h as U,j as $,am as Z,aB as ee,z as F,E as k,G as q,g as _,aC as L,_ as G,aD as le,x as B,f as I,t as V,F as N,a7 as te,aE as ae,A as z,a1 as oe,a2 as ne,S as E,aF as ue,aG as se,Q as ie,aH as re,T as de,U as me,V as pe,W as j,X as ve}from"./index-DTUDYeuU.js";import{_ as ce}from"./MdEditor.vue_vue_type_script_setup_true_lang-tVINuch9.js";import"./markdown-O7Rz5C9z.js";const fe={class:"basic-container"},be={style:{width:"500px"}},_e=M({__name:"ContestEditBasic",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(x){const l=R(x,"modelValue"),r=c([l.value.startTime,l.value.endTime]);Y(r,()=>{r.value&&([l.value.startTime,l.value.endTime]=r.value)});const u=c(!1);function m(){u.value=!0,L({contest:l.value}).then(w=>{l.value=w.contest}).finally(()=>{u.value=!1})}return(w,o)=>{const f=g("el-date-picker"),T=g("el-button");return v(),C("div",fe,[e(t(q),{modelValue:l.value,"onUpdate:modelValue":o[7]||(o[7]=s=>l.value=s),"label-width":100},{default:a(()=>[e(t(y),{label:"比赛名称"},{default:a(()=>[e(t(D),{style:{width:"500px"},modelValue:l.value.title,"onUpdate:modelValue":o[0]||(o[0]=s=>l.value.title=s)},null,8,["modelValue"])]),_:1}),e(t(y),{label:"起止时间"},{default:a(()=>[U("div",be,[e(f,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=s=>r.value=s),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])]),_:1}),e(t(y),{label:"头图"},{default:a(()=>[U("div",null,[e(t(D),{style:{width:"500px"},modelValue:l.value.banner,"onUpdate:modelValue":o[2]||(o[2]=s=>l.value.banner=s)},null,8,["modelValue"]),o[8]||(o[8]=U("div",null," 填入比赛头图 URL，用于在比赛列表展示。若为空则不显示。 ",-1)),l.value.banner?(v(),C("div",{key:0,class:"contest-banner",style:Z({backgroundImage:`url(${l.value.banner})`})},null,4)):$("",!0)])]),_:1}),e(t(y),{label:"描述"},{default:a(()=>[e(ce,{class:"editor",modelValue:l.value.description,"onUpdate:modelValue":o[3]||(o[3]=s=>l.value.description=s)},null,8,["modelValue"])]),_:1}),e(t(y),{label:"难度"},{default:a(()=>[e(t(ee),{modelValue:l.value.difficulty,"onUpdate:modelValue":o[4]||(o[4]=s=>l.value.difficulty=s)},null,8,["modelValue"])]),_:1}),e(t(y),{label:"赛制"},{default:a(()=>[e(t(F),{modelValue:l.value.rule,"onUpdate:modelValue":o[5]||(o[5]=s=>l.value.rule=s),class:"form-item"},{default:a(()=>[e(t(k),{value:"OI",label:"OI 赛制"}),e(t(k),{value:"ACM",label:"ACM 赛制"}),e(t(k),{value:"IOI",label:"IOI 赛制"})]),_:1},8,["modelValue"])]),_:1}),e(t(y),{label:"权限"},{default:a(()=>[e(t(F),{modelValue:l.value.status,"onUpdate:modelValue":o[6]||(o[6]=s=>l.value.status=s),class:"form-item"},{default:a(()=>[e(t(k),{value:"public",label:"公开"}),e(t(k),{value:"private",label:"邀请"}),e(t(k),{value:"delete",label:"删除"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(T,{loading:u.value,type:"primary",onClick:m},{default:a(()=>o[9]||(o[9]=[_(" 保存 ")])),_:1},8,["loading"])])}}}),Ve=G(_e,[["__scopeId","data-v-6acaec8a"]]),ye={class:"basic-container"},ge={class:"preview"},Ce=M({__name:"ContestEditProblemset",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(x){const l=R(x,"modelValue"),r=c(void 0),u=c(void 0),m=c(null),w=le(s,500),o=d=>({public:"公开",private:"私有",contest:"比赛"})[d]||"未知",f=d=>({public:"success",private:"info",contest:"warning"})[d]||"",T=d=>({traditional:"传统题",interactive:"交互题"})[d]||"未知";function s(){if(r.value===void 0){m.value=null;return}se({problem:r.value}).then(d=>{m.value=d.problem})}const b=c([]);function H(){if(r.value===void 0){E.fire({icon:"error",title:"错误",text:"请选择新试题 ID"});return}if(u.value===void 0){E.fire({icon:"error",title:"错误",text:"请选择新试题标签"});return}if(u.value in l.value.problems){E.fire({icon:"error",title:"错误",text:"标签不能重复"});return}l.value.problems[u.value]=r.value,u.value=void 0,r.value=void 0,m.value=null,S()}function J(d){E.fire({title:"确认删除吗？",icon:"warning",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)if(d in l.value.problems)delete l.value.problems[d],S();else{E.fire({icon:"error",title:"错误",text:"不存在的试题"});return}})}const O=c(!1);function P(){l.value&&(O.value=!0,b.value=[],ue({contest:l.value.id}).then(d=>{d.problems.sort((n,p)=>n.id-p.id);for(const n of d.problems)b.value.push({problem:n,label:Q(n.id)})}).finally(()=>{O.value=!1}))}function Q(d){if(!l.value)return null;const n=Object.keys(l.value.problems);for(const p of n)if(l.value.problems[p]===d)return p;return null}const A=c(!1);function S(){A.value=!0,L({contest:l.value}).then(d=>{l.value=d.contest,P()}).finally(()=>{A.value=!1})}return P(),(d,n)=>{const p=g("el-table-column"),W=g("router-link"),X=g("el-tag"),K=g("el-table");return v(),C("div",ye,[e(t(q),{"label-width":100},{default:a(()=>[e(t(y),{label:"添加试题",class:"form-item"},{default:a(()=>{var i;return[e(t(D),{class:"input-label",placeholder:"标签",modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=h=>u.value=h)},null,8,["modelValue"]),e(t(D),{class:"input-id",onInput:t(w),type:"number",modelValue:r.value,"onUpdate:modelValue":n[1]||(n[1]=h=>r.value=h),modelModifiers:{number:!0}},null,8,["onInput","modelValue"]),m.value?(v(),C(B,{key:0},[U("span",ge,V(m.value.id)+" "+V(m.value.title["zh-CN"]||Object.values((i=m.value)==null?void 0:i.title)[0]||"暂无标题"),1),m.value.status==="contest"?(v(),I(t(N),{key:0,style:{color:"var(--el-color-success)"},icon:t(te)},null,8,["icon"])):(v(),C(B,{key:1},[e(t(N),{style:{color:"var(--el-color-warning)"},icon:t(ae)},null,8,["icon"]),n[2]||(n[2]=U("span",{class:"info-convey"},"题目状态将在添加后转为比赛赛题",-1))],64))],64)):$("",!0)]}),_:1}),e(t(z),{type:"primary",onClick:H},{default:a(()=>n[3]||(n[3]=[_(" 添加 ")])),_:1})]),_:1}),e(K,{data:b.value,border:"",style:{width:"100%","margin-top":"20px"}},{default:a(()=>[e(p,{prop:"label",label:"标签",width:"60"}),e(p,{prop:"problem.id",label:"ID",width:"75"}),e(p,{label:"标题","min-width":"200"},{default:a(({row:i})=>[e(W,{to:`/problem/${i.problem.id}`,class:"title-link"},{default:a(()=>[_(V(i.problem.title["zh-CN"]||Object.values(i.problem.title)[0]||"暂无标题"),1)]),_:2},1032,["to"])]),_:1}),e(p,{label:"状态",width:"100"},{default:a(({row:i})=>[e(X,{type:f(i.problem.status)},{default:a(()=>[_(V(o(i.problem.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"类型",width:"100"},{default:a(({row:i})=>[_(V(T(i.problem.type)),1)]),_:1}),e(p,{label:"时间限制",width:"120"},{default:a(({row:i})=>[_(V(t(oe)(i.problem.limitTime)),1)]),_:1}),e(p,{label:"空间限制",width:"120"},{default:a(({row:i})=>[_(V(t(ne)(i.problem.limitMemory)),1)]),_:1}),e(p,{label:"难度",width:"120"},{default:a(({row:i})=>[_(V(i.problem.difficulty),1)]),_:1}),e(p,{label:"操作",width:"75",fixed:"right"},{default:a(({row:i})=>[e(t(z),{text:"",type:"danger",size:"small",onClick:h=>J(i.label)},{default:a(()=>n[4]||(n[4]=[_("移除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])}}}),we=G(Ce,[["__scopeId","data-v-974fea13"]]),ke={key:0,style:{height:"200px"}},Ie=M({__name:"ViewContestEdit",props:{cid_str:{}},setup(x){const l=c("basic"),r=x,u=c(null),m=c(!1);async function w(){u.value=null,r.cid_str?(m.value=!0,await re({contest:parseInt(r.cid_str)}).then(o=>{u.value=o.contest}).finally(()=>{m.value=!1})):u.value={id:0,title:"",summary:"",description:"",difficulty:1,status:"private",startTime:new Date,endTime:new Date,rule:"ACM",problems:{},createdAt:new Date,updatedAt:new Date,deletedAt:new Date}}return w(),(o,f)=>{const T=g("el-empty"),s=de("loading");return v(),I(ie,{bread:[{label:"Reisen Online Judge",to:{name:"home"}},{label:"比赛列表",to:{name:"contest-list"}},{label:`#${r.cid_str}`,to:{name:"contest-detail",params:{cid_str:r.cid_str}}},{label:"比赛编辑"}]},{default:a(()=>[e(t(me),null,{default:a(()=>[u.value?(v(),I(t(pe),{key:0,modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=b=>l.value=b)},{default:a(()=>[e(t(j),{label:"基本信息",name:"basic"},{default:a(()=>[e(Ve,{modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=b=>u.value=b)},null,8,["modelValue"])]),_:1}),u.value.id!==0?(v(),I(t(j),{key:0,label:"比赛试题",name:"problemset"},{default:a(()=>[e(we,{modelValue:u.value,"onUpdate:modelValue":f[1]||(f[1]=b=>u.value=b)},null,8,["modelValue"])]),_:1})):$("",!0)]),_:1},8,["modelValue"])):(v(),C(B,{key:1},[m.value?ve((v(),C("div",ke,null,512)),[[s,!0]]):(v(),I(T,{key:1,description:"暂无数据"}))],64))]),_:1})]),_:1},8,["bread"])}}});export{Ie as default};
