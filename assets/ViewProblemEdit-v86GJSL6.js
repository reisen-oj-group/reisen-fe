import{i as H,b as J,a as K,c as F,d as x,m as Q,u as M,r as $,e as _,o as v,w as u,f as b,g as k,h as A,t as R,j as e,F as L,k as Z,_ as S,l as j,n as g,p as W,q as c,s as l,v as C,x as q,E as B,y as P,z as G,A as y,B as w,C as O,D as X,G as E,H as Y,I as h,J as ee,K as le,L as ae,M as N,N as te,O as oe,P as ue,Q as ne,R as de,S as se,T as z,U as ie}from"./index-CALB36uv.js";import{_ as re}from"./MdEditor.vue_vue_type_script_setup_true_lang-BCw9rNio.js";import"./markdown-Ptyy3W22.js";var me=Array.prototype,pe=me.splice;function ve(d,i){for(var o=d?i.length:0,a=o-1;o--;){var t=i[o];if(o==a||t!==n){var n=t;H(t)?pe.call(d,t,1):J(d,t)}}return d}function fe(d,i){var o=[];if(!(d&&d.length))return o;var a=-1,t=[],n=d.length;for(i=K(i);++a<n;){var f=d[a];i(f,a,d)&&(o.push(f),t.push(a))}return ve(d,t),o}const Ve=async d=>F("/testdata",{method:"POST",body:d}),be=async d=>{const i=new FormData;return i.append("problem",d.problem.toString()),i.append("file",d.file),F("/testdata/upload",{method:"POST",body:i})},ce=async d=>F("/testdata/delete",{method:"POST",body:d}),ye={class:"label-container"},_e=x({__name:"ProblemEditPart",props:Q({label:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const i=M(d,"modelValue");return(o,a)=>{const t=$("el-button"),n=$("el-form-item");return v(),_(n,null,{label:u(()=>[k("div",ye,[b(R(o.label)+" ",1),i.value!==void 0?(v(),_(e(L),{key:0,icon:e(Z),onClick:a[0]||(a[0]=f=>i.value=void 0)},null,8,["icon"])):A("",!0)])]),default:u(()=>[i.value!==void 0?(v(),_(re,{key:0,class:"editor",modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=f=>i.value=f)},null,8,["modelValue"])):(v(),_(t,{key:1,type:"primary",onClick:a[2]||(a[2]=f=>i.value="")},{default:u(()=>a[3]||(a[3]=[b("创建")])),_:1}))]),_:1})}}}),I=S(_e,[["__scopeId","data-v-2ae1d641"]]),ge={class:"editor-container"},ke={class:"lang-select-container"},we={class:"example-container"},Ue=x({__name:"ProblemEditContent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=j(),o=M(d,"modelValue"),a=g(void 0),t=g(void 0),n=g(void 0);function f(){a.value&&(t.value={examples:[]})}function r(){a.value&&(delete o.value.title[a.value],delete o.value.statements[a.value],t.value=o.value.statements[a.value])}function T(){!a.value||n.value===void 0||t.value===void 0||(o.value.title[a.value]=n.value,o.value.statements[a.value]=X(t.value))}function V(m){t.value&&fe(t.value.examples,(s,p)=>p===m)}return W(a,()=>{a.value&&(t.value=o.value.statements[a.value])}),(m,s)=>(v(),c("div",ge,[k("div",ke,[l(e(B),{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=p=>a.value=p),style:{width:"150px","margin-right":"1em"}},{default:u(()=>[(v(!0),c(C,null,q(e(i).config.userLangs,(p,U)=>(v(),_(e(E),{key:U,value:U,label:p.description},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),a.value?(v(),_(e(P),{key:0,type:"danger",onClick:r},{default:u(()=>s[8]||(s[8]=[b(" 删除 ")])),_:1})):A("",!0)]),l(e(G)),a.value?(v(),c(C,{key:0},[t.value?(v(),c(C,{key:0},[l(e(O),{"label-width":100,"label-position":"left"},{default:u(()=>[l(e(y),{label:"标题"},{default:u(()=>[l(e(w),{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=p=>n.value=p)},null,8,["modelValue"])]),_:1}),l(I,{label:"题目背景",modelValue:t.value.background,"onUpdate:modelValue":s[2]||(s[2]=p=>t.value.background=p)},null,8,["modelValue"]),l(I,{label:"输入格式",modelValue:t.value.formatI,"onUpdate:modelValue":s[3]||(s[3]=p=>t.value.formatI=p)},null,8,["modelValue"]),l(I,{label:"输出格式",modelValue:t.value.formatO,"onUpdate:modelValue":s[4]||(s[4]=p=>t.value.formatO=p)},null,8,["modelValue"]),(v(!0),c(C,null,q(t.value.examples,(p,U)=>(v(),_(e(y),{key:U},{label:u(()=>[k("div",null,[b(R(`样例组 #${U+1}`)+" ",1),l(e(L),{icon:e(Z),onClick:D=>V(U)},null,8,["icon","onClick"])])]),default:u(()=>[k("div",we,[l(e(w),{type:"textarea",modelValue:p.dataI,"onUpdate:modelValue":D=>p.dataI=D,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"]),l(e(w),{type:"textarea",modelValue:p.dataO,"onUpdate:modelValue":D=>p.dataO=D,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128)),l(e(y),null,{default:u(()=>[l(e(P),{type:"primary",plain:"",onClick:s[5]||(s[5]=p=>t.value.examples.push({dataI:"",dataO:""}))},{default:u(()=>s[9]||(s[9]=[b("新建样例")])),_:1})]),_:1}),l(I,{label:"提示",modelValue:t.value.hint,"onUpdate:modelValue":s[6]||(s[6]=p=>t.value.hint=p)},null,8,["modelValue"])]),_:1}),l(e(P),{type:"primary",onClick:T},{default:u(()=>s[10]||(s[10]=[b(" 保存 ")])),_:1})],64)):(v(),c(C,{key:1},[l(e(O),null,{default:u(()=>[l(e(y),{label:"标题"},{default:u(()=>[l(e(w),{modelValue:n.value,"onUpdate:modelValue":s[7]||(s[7]=p=>n.value=p)},null,8,["modelValue"])]),_:1})]),_:1}),l(e(P),{type:"primary",onClick:f},{default:u(()=>s[11]||(s[11]=[b(" 创建 ")])),_:1})],64))],64)):A("",!0)]))}}),Ce=S(Ue,[["__scopeId","data-v-a2cb1051"]]),Ee={class:"basic-container"},Pe=x({__name:"ProblemEditBasic",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const{difficulties:i}=j().config,o=M(d,"modelValue");function a(){}return(t,n)=>{const f=$("el-button");return v(),c("div",Ee,[l(e(O),{modelValue:o.value,"onUpdate:modelValue":n[5]||(n[5]=r=>o.value=r),style:{"max-width":"200px"}},{default:u(()=>[l(e(y),{label:"时间限制"},{default:u(()=>[l(e(w),{modelValue:o.value.limitTime,"onUpdate:modelValue":n[0]||(n[0]=r=>o.value.limitTime=r)},null,8,["modelValue"])]),_:1}),l(e(y),{label:"空间限制"},{default:u(()=>[l(e(w),{modelValue:o.value.limitTime,"onUpdate:modelValue":n[1]||(n[1]=r=>o.value.limitTime=r)},null,8,["modelValue"])]),_:1}),l(e(y),{label:"可见状态"},{default:u(()=>[l(e(B),{modelValue:o.value.status,"onUpdate:modelValue":n[2]||(n[2]=r=>o.value.status=r)},{default:u(()=>[l(e(E),{value:"public",label:"公开"}),l(e(E),{value:"contest",label:"比赛"}),l(e(E),{value:"private",label:"隐藏"})]),_:1},8,["modelValue"])]),_:1}),l(e(y),{label:"题目类型"},{default:u(()=>[l(e(B),{modelValue:o.value.type,"onUpdate:modelValue":n[3]||(n[3]=r=>o.value.type=r)},{default:u(()=>[l(e(E),{value:"traditional",label:"传统"}),l(e(E),{value:"interactive",label:"交互"})]),_:1},8,["modelValue"])]),_:1}),l(e(y),{label:"题目难度"},{default:u(()=>[l(e(w),{modelValue:o.value.difficulty,"onUpdate:modelValue":n[4]||(n[4]=r=>o.value.difficulty=r)},null,8,["modelValue"])]),_:1}),l(e(y),{label:"标签设置"})]),_:1},8,["modelValue"]),l(f,{type:"primary",onClick:a},{default:u(()=>n[6]||(n[6]=[b(" 保存 ")])),_:1})])}}}),Te=S(Pe,[["__scopeId","data-v-3fed033a"]]),xe={class:"testdata-container"},De={class:"data-actions"},Ie=x({__name:"ProblemEditTestdata",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=Y(),o=M(d,"modelValue"),a=g(!1),t=g(!1);g(null),h(()=>({Authorization:`Bearer ${i.currentToken}`}));const n=V=>{const m=V.type==="application/zip"||V.name.endsWith(".zip"),s=V.size/1024/1024<50;return m?s?!0:(N.error("数据包大小不能超过 50MB！"),!1):(N.error("数据包必须是 ZIP 格式！"),!1)},f=async V=>{const m={file:V.file,problem:o.value.id};await be(m)},r=async()=>{a.value=!0;try{const V=await Ve({problem:o.value.id});V.url&&window.open(V.url,"_blank")}finally{a.value=!1}},T=async()=>{t.value=!0;try{await ce({problem:o.value.id})}finally{t.value=!1}};return(V,m)=>(v(),c("div",xe,[l(e(le),{class:"upload-testdata",drag:"",limit:1,"before-upload":n,"auto-upload":!0,"http-request":f},{tip:u(()=>m[0]||(m[0]=[k("div",{class:"el-upload__tip"},"数据包应为zip格式，大小不超过200MB",-1)])),default:u(()=>[l(e(L),{icon:e(ee),size:"2x"},null,8,["icon"]),m[1]||(m[1]=k("div",{class:"el-upload__text"},[b("将数据包拖拽至此处，或者"),k("em",null,"点击上传")],-1))]),_:1}),l(e(G)),k("div",De,[l(e(P),{type:"primary",loading:a.value,onClick:r},{default:u(()=>m[2]||(m[2]=[b(" 下载当前数据包 ")])),_:1},8,["loading"]),l(e(P),{type:"danger",loading:t.value,onClick:T},{default:u(()=>m[3]||(m[3]=[b(" 删除数据包 ")])),_:1},8,["loading"])]),l(e(ae),{title:"配置文件说明",type:"info",closable:!1,description:"配置文件为YAML格式，用于定义测试数据的评分规则、时间限制等。",class:"mb-4"})]))}}),$e=S(Ie,[["__scopeId","data-v-c5a606fc"]]),Me={key:0,style:{height:"200px"}},Be=x({__name:"ViewProblemEdit",props:{pid_str:{}},setup(d){const i=g("basic"),o=d,a=g(null),t=g(!1);async function n(){a.value=null,o.pid_str?(t.value=!0,await ue({problem:parseInt(o.pid_str)}).then(f=>{a.value=f.problem}).finally(()=>{t.value=!1})):a.value={id:0,type:"traditional",statements:{},status:"private",limitTime:0,limitMemory:0,countCorrect:0,countTotal:0,difficulty:0,tags:[],title:{},hasTestdata:!1,hasConfig:!1,updatedAt:new Date(0),createdAt:new Date(0)}}return te(()=>{n()}),(f,r)=>{const T=$("el-empty"),V=ne("loading");return v(),_(oe,null,{default:u(()=>[l(e(de),null,{default:u(()=>[a.value?(v(),_(e(se),{key:0,modelValue:i.value,"onUpdate:modelValue":r[3]||(r[3]=m=>i.value=m)},{default:u(()=>[l(e(z),{label:"基本信息",name:"basic"},{default:u(()=>[l(Te,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=m=>a.value=m)},null,8,["modelValue"])]),_:1}),l(e(z),{label:"题面编辑",name:"statement"},{default:u(()=>[l(Ce,{modelValue:a.value,"onUpdate:modelValue":r[1]||(r[1]=m=>a.value=m)},null,8,["modelValue"])]),_:1}),l(e(z),{label:"数据上传",name:"testdata"},{default:u(()=>[l($e,{modelValue:a.value,"onUpdate:modelValue":r[2]||(r[2]=m=>a.value=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])):(v(),c(C,{key:1},[t.value?ie((v(),c("div",Me,null,512)),[[V,!0]]):(v(),_(T,{key:1,description:"暂无数据"}))],64))]),_:1})]),_:1})}}});export{Be as default};
