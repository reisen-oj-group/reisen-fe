import{i as J,b as K,a as Q,c as W,d as Y,e as M,m as h,u as B,r as $,f as k,o as v,w as o,g as c,h as w,j as O,t as X,k as l,F as q,l as Z,_ as S,n as j,p as y,q as ee,s as _,v as a,x as E,y as R,E as F,z as P,A as G,B as g,C as U,D as L,S as le,G as ae,H,I as x,J as te,K as oe,L as ue,M as ne,N as de,O as N,P as se,Q as ie,R as re,T as me,U as ve,V as pe,W as A,X as fe}from"./index-D9OJ9fva.js";import{_ as be}from"./MdEditor.vue_vue_type_script_setup_true_lang-ii9MsryQ.js";import"./markdown-Ca-TJ-LV.js";var Ve=Array.prototype,ce=Ve.splice;function ye(d,i){for(var n=d?i.length:0,e=n-1;n--;){var t=i[n];if(n==e||t!==p){var p=t;J(t)?ce.call(d,t,1):K(d,t)}}return d}function _e(d,i){var n=[];if(!(d&&d.length))return n;var e=-1,t=[],p=d.length;for(i=Q(i);++e<p;){var u=d[e];i(u,e,d)&&(n.push(u),t.push(e))}return ye(d,t),n}const ge=async d=>Y("/testdata",{method:"POST",body:d}),ke=async d=>{const i=new FormData;return i.append("problem",d.problem.toString()),i.append("file",d.file),W("/testdata/upload",{method:"POST",body:i})},we=async d=>W("/testdata/delete",{method:"POST",body:d}),Ue={class:"label-container"},Ce=M({__name:"ProblemEditPart",props:h({label:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const i=B(d,"modelValue");return(n,e)=>{const t=$("el-button"),p=$("el-form-item");return v(),k(p,null,{label:o(()=>[w("div",Ue,[c(X(n.label)+" ",1),i.value!==void 0?(v(),k(l(q),{key:0,icon:l(Z),onClick:e[0]||(e[0]=u=>i.value=void 0)},null,8,["icon"])):O("",!0)])]),default:o(()=>[i.value!==void 0?(v(),k(be,{key:0,class:"editor",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=u=>i.value=u)},null,8,["modelValue"])):(v(),k(t,{key:1,type:"primary",onClick:e[2]||(e[2]=u=>i.value="")},{default:o(()=>e[3]||(e[3]=[c("创建")])),_:1}))]),_:1})}}}),T=S(Ce,[["__scopeId","data-v-2ae1d641"]]),Ee={class:"editor-container"},xe={class:"lang-select-container"},Pe={class:"example-container"},Te=M({__name:"ProblemEditContent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=j(),n=B(d,"modelValue"),e=y(void 0),t=y(void 0),p=y(void 0),u=y(!1);function b(){e.value&&(t.value={examples:[]})}function f(){e.value&&le.fire({title:"确认删除吗？",text:"删除后将无法恢复！",icon:"warning",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(D=>{e.value&&D.isConfirmed&&(delete n.value.title[e.value],delete n.value.statements[e.value],t.value=n.value.statements[e.value],m())})}function V(){!e.value||p.value===void 0||t.value===void 0||(n.value.title[e.value]=p.value,n.value.statements[e.value]=ae(t.value),m())}async function m(){u.value=!0;try{await H({problem:n.value})}finally{u.value=!1}}function z(D){t.value&&_e(t.value.examples,(s,r)=>r===D)}return ee(e,()=>{e.value&&(t.value=n.value.statements[e.value],p.value=n.value.title[e.value])}),(D,s)=>(v(),_("div",Ee,[w("div",xe,[a(l(F),{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=r=>e.value=r),style:{width:"150px","margin-right":"1em"}},{default:o(()=>[(v(!0),_(E,null,R(l(i).config.userLangs,(r,C)=>(v(),k(l(x),{key:C,value:C,label:r.description},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),e.value?(v(),k(l(P),{key:0,loading:u.value,type:"danger",onClick:f},{default:o(()=>s[9]||(s[9]=[c(" 删除 ")])),_:1},8,["loading"])):O("",!0)]),a(l(G)),e.value?(v(),_(E,{key:0},[t.value?(v(),_(E,{key:0},[a(l(L),{"label-width":100,"label-position":"left"},{default:o(()=>[a(l(g),{label:"标题"},{default:o(()=>[a(l(U),{modelValue:p.value,"onUpdate:modelValue":s[1]||(s[1]=r=>p.value=r)},null,8,["modelValue"])]),_:1}),a(T,{label:"题目背景",modelValue:t.value.background,"onUpdate:modelValue":s[2]||(s[2]=r=>t.value.background=r)},null,8,["modelValue"]),a(T,{label:"题目描述",modelValue:t.value.legend,"onUpdate:modelValue":s[3]||(s[3]=r=>t.value.legend=r)},null,8,["modelValue"]),a(T,{label:"输入格式",modelValue:t.value.formatI,"onUpdate:modelValue":s[4]||(s[4]=r=>t.value.formatI=r)},null,8,["modelValue"]),a(T,{label:"输出格式",modelValue:t.value.formatO,"onUpdate:modelValue":s[5]||(s[5]=r=>t.value.formatO=r)},null,8,["modelValue"]),(v(!0),_(E,null,R(t.value.examples,(r,C)=>(v(),k(l(g),{key:C},{label:o(()=>[w("div",null,[c(X(`样例组 #${C+1}`)+" ",1),a(l(q),{icon:l(Z),onClick:I=>z(C)},null,8,["icon","onClick"])])]),default:o(()=>[w("div",Pe,[a(l(U),{type:"textarea",modelValue:r.dataI,"onUpdate:modelValue":I=>r.dataI=I,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"]),a(l(U),{type:"textarea",modelValue:r.dataO,"onUpdate:modelValue":I=>r.dataO=I,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128)),a(l(g),null,{default:o(()=>[a(l(P),{type:"primary",plain:"",onClick:s[6]||(s[6]=r=>t.value.examples.push({dataI:"",dataO:""}))},{default:o(()=>s[10]||(s[10]=[c("新建样例")])),_:1})]),_:1}),a(T,{label:"提示",modelValue:t.value.hint,"onUpdate:modelValue":s[7]||(s[7]=r=>t.value.hint=r)},null,8,["modelValue"])]),_:1}),a(l(P),{loading:u.value,type:"primary",onClick:V},{default:o(()=>s[11]||(s[11]=[c(" 保存 ")])),_:1},8,["loading"])],64)):(v(),_(E,{key:1},[a(l(L),null,{default:o(()=>[a(l(g),{label:"标题"},{default:o(()=>[a(l(U),{modelValue:p.value,"onUpdate:modelValue":s[8]||(s[8]=r=>p.value=r)},null,8,["modelValue"])]),_:1})]),_:1}),a(l(P),{type:"primary",onClick:b},{default:o(()=>s[12]||(s[12]=[c(" 创建 ")])),_:1})],64))],64)):O("",!0)]))}}),Me=S(Te,[["__scopeId","data-v-537a5882"]]),De={class:"basic-container"},Ie=M({__name:"ProblemEditBasic",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const{difficulties:i}=j().config,n=y(!1),e=B(d,"modelValue");async function t(){n.value=!0;try{await H({problem:e.value})}finally{n.value=!1}}return(p,u)=>{const b=$("el-button");return v(),_("div",De,[a(l(L),{modelValue:e.value,"onUpdate:modelValue":u[5]||(u[5]=f=>e.value=f),style:{"max-width":"200px"}},{default:o(()=>[a(l(g),{label:"时间限制"},{default:o(()=>[a(l(U),{modelValue:e.value.limitTime,"onUpdate:modelValue":u[0]||(u[0]=f=>e.value.limitTime=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"空间限制"},{default:o(()=>[a(l(U),{modelValue:e.value.limitMemory,"onUpdate:modelValue":u[1]||(u[1]=f=>e.value.limitMemory=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"可见状态"},{default:o(()=>[a(l(F),{modelValue:e.value.status,"onUpdate:modelValue":u[2]||(u[2]=f=>e.value.status=f)},{default:o(()=>[a(l(x),{value:"public",label:"公开"}),a(l(x),{value:"contest",label:"比赛"}),a(l(x),{value:"private",label:"隐藏"})]),_:1},8,["modelValue"])]),_:1}),a(l(g),{label:"题目类型"},{default:o(()=>[a(l(F),{modelValue:e.value.type,"onUpdate:modelValue":u[3]||(u[3]=f=>e.value.type=f)},{default:o(()=>[a(l(x),{value:"traditional",label:"传统"}),a(l(x),{value:"interactive",label:"交互"})]),_:1},8,["modelValue"])]),_:1}),a(l(g),{label:"题目难度"},{default:o(()=>[a(l(U),{modelValue:e.value.difficulty,"onUpdate:modelValue":u[4]||(u[4]=f=>e.value.difficulty=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"标签设置"})]),_:1},8,["modelValue"]),a(b,{loading:n.value,type:"primary",onClick:t},{default:o(()=>u[6]||(u[6]=[c(" 保存 ")])),_:1},8,["loading"])])}}}),$e=S(Ie,[["__scopeId","data-v-b39b7d1a"]]),Be={class:"testdata-container"},Se={class:"data-actions"},ze=M({__name:"ProblemEditTestdata",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=te(),n=B(d,"modelValue"),e=y(!1),t=y(!1);y(null),oe(()=>({Authorization:`Bearer ${i.currentToken}`}));const p=V=>{const m=V.type==="application/zip"||V.name.endsWith(".zip"),z=V.size/1024/1024<50;return m?z?!0:(N.error("数据包大小不能超过 50MB！"),!1):(N.error("数据包必须是 ZIP 格式！"),!1)},u=async V=>{const m={file:V.file,problem:n.value.id};await ke(m)},b=async()=>{e.value=!0;try{const V=await ge({problem:n.value.id});V.url&&window.open(V.url,"_blank")}finally{e.value=!1}},f=async()=>{t.value=!0;try{await we({problem:n.value.id})}finally{t.value=!1}};return(V,m)=>(v(),_("div",Be,[a(l(ne),{class:"upload-testdata",drag:"",limit:1,"before-upload":p,"auto-upload":!0,"http-request":u},{tip:o(()=>m[0]||(m[0]=[w("div",{class:"el-upload__tip"},"数据包应为zip格式，大小不超过200MB",-1)])),default:o(()=>[a(l(q),{icon:l(ue),size:"2x"},null,8,["icon"]),m[1]||(m[1]=w("div",{class:"el-upload__text"},[c("将数据包拖拽至此处，或者"),w("em",null,"点击上传")],-1))]),_:1}),a(l(G)),w("div",Se,[a(l(P),{type:"primary",loading:e.value,onClick:b},{default:o(()=>m[2]||(m[2]=[c(" 下载当前数据包 ")])),_:1},8,["loading"]),a(l(P),{type:"danger",loading:t.value,onClick:f},{default:o(()=>m[3]||(m[3]=[c(" 删除数据包 ")])),_:1},8,["loading"])]),a(l(de),{title:"配置文件说明",type:"info",closable:!1,description:"配置文件为YAML格式，用于定义测试数据的评分规则、时间限制等。",class:"mb-4"})]))}}),Ae=S(ze,[["__scopeId","data-v-c5a606fc"]]),Oe={key:0,style:{height:"200px"}},Re=M({__name:"ViewProblemEdit",props:{pid_str:{}},setup(d){const i=y("basic"),n=d,e=y(null),t=y(!1);async function p(){e.value=null,n.pid_str?(t.value=!0,await re({problem:parseInt(n.pid_str)}).then(u=>{e.value=u.problem}).finally(()=>{t.value=!1})):e.value={id:0,type:"traditional",statements:{},status:"private",limitTime:1e3,limitMemory:1e3,countCorrect:0,countTotal:0,difficulty:0,provider:0,tags:[],title:{},hasTestdata:!1,hasConfig:!1,updatedAt:new Date(0),createdAt:new Date(0)}}return se(()=>{p()}),(u,b)=>{const f=$("el-empty"),V=me("loading");return v(),k(ie,null,{default:o(()=>[a(l(ve),null,{default:o(()=>[e.value?(v(),k(l(pe),{key:0,modelValue:i.value,"onUpdate:modelValue":b[3]||(b[3]=m=>i.value=m)},{default:o(()=>[a(l(A),{label:"基本信息",name:"basic"},{default:o(()=>[a($e,{modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=m=>e.value=m)},null,8,["modelValue"])]),_:1}),a(l(A),{label:"题面编辑",name:"statement"},{default:o(()=>[a(Me,{modelValue:e.value,"onUpdate:modelValue":b[1]||(b[1]=m=>e.value=m)},null,8,["modelValue"])]),_:1}),a(l(A),{label:"数据上传",name:"testdata"},{default:o(()=>[a(Ae,{modelValue:e.value,"onUpdate:modelValue":b[2]||(b[2]=m=>e.value=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])):(v(),_(E,{key:1},[t.value?fe((v(),_("div",Oe,null,512)),[[V,!0]]):(v(),k(f,{key:1,description:"暂无数据"}))],64))]),_:1})]),_:1})}}});export{Re as default};
