import{i as H,b as K,a as Q,c as J,d as Y,e as D,m as h,u as B,r as $,f as w,o as p,w as o,g as c,h as k,j as O,t as W,k as l,F as R,l as X,_ as S,n as Z,p as y,q as ee,s as _,v as a,x as E,y as q,E as x,z as F,A as P,B as j,C as g,D as U,G as L,S as le,H as ae,I as G,J as te,K as oe,L as ue,M as ne,N as de,O as N,P as se,Q as ie,R as re,T as me,U as pe,V as ve,W as z,X as fe}from"./index-DTUDYeuU.js";import{_ as be}from"./MdEditor.vue_vue_type_script_setup_true_lang-tVINuch9.js";import"./markdown-O7Rz5C9z.js";var Ve=Array.prototype,ce=Ve.splice;function ye(d,i){for(var u=d?i.length:0,e=u-1;u--;){var t=i[u];if(u==e||t!==v){var v=t;H(t)?ce.call(d,t,1):K(d,t)}}return d}function _e(d,i){var u=[];if(!(d&&d.length))return u;var e=-1,t=[],v=d.length;for(i=Q(i);++e<v;){var n=d[e];i(n,e,d)&&(u.push(n),t.push(e))}return ye(d,t),u}const ge=async d=>Y("/testdata/download",{method:"POST",body:d}),we=async d=>{const i=new FormData;return i.append("problem",d.problem.toString()),i.append("file",d.file),J("/testdata/upload",{method:"POST",body:i})},ke=async d=>J("/testdata/delete",{method:"POST",body:d}),Ue={class:"label-container"},Ce=D({__name:"ProblemEditPart",props:h({label:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const i=B(d,"modelValue");return(u,e)=>{const t=$("el-button"),v=$("el-form-item");return p(),w(v,null,{label:o(()=>[k("div",Ue,[c(W(u.label)+" ",1),i.value!==void 0?(p(),w(l(R),{key:0,icon:l(X),onClick:e[0]||(e[0]=n=>i.value=void 0)},null,8,["icon"])):O("",!0)])]),default:o(()=>[i.value!==void 0?(p(),w(be,{key:0,class:"editor",modelValue:i.value,"onUpdate:modelValue":e[1]||(e[1]=n=>i.value=n)},null,8,["modelValue"])):(p(),w(t,{key:1,type:"primary",onClick:e[2]||(e[2]=n=>i.value="")},{default:o(()=>e[3]||(e[3]=[c("创建")])),_:1}))]),_:1})}}}),T=S(Ce,[["__scopeId","data-v-bdd29fbd"]]),Ee={class:"editor-container"},xe={class:"lang-select-container"},Pe={class:"example-container"},Te=D({__name:"ProblemEditContent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=Z(),u=B(d,"modelValue"),e=y(void 0),t=y(void 0),v=y(void 0),n=y(!1);function b(){e.value&&(t.value={examples:[]})}function f(){e.value&&le.fire({title:"确认删除吗？",text:"删除后将无法恢复！",icon:"warning",showCancelButton:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(M=>{e.value&&M.isConfirmed&&(delete u.value.title[e.value],delete u.value.statements[e.value],t.value=u.value.statements[e.value],m())})}function V(){!e.value||v.value===void 0||t.value===void 0||(u.value.title[e.value]=v.value,u.value.statements[e.value]=ae(t.value),m())}async function m(){n.value=!0;try{await G({problem:u.value})}finally{n.value=!1}}function A(M){t.value&&_e(t.value.examples,(s,r)=>r===M)}return ee(e,()=>{e.value&&(t.value=u.value.statements[e.value],v.value=u.value.title[e.value])}),(M,s)=>(p(),_("div",Ee,[k("div",xe,[a(l(F),{modelValue:e.value,"onUpdate:modelValue":s[0]||(s[0]=r=>e.value=r),style:{width:"150px","margin-right":"1em"}},{default:o(()=>[(p(!0),_(E,null,q(l(i).config.userLangs,(r,C)=>(p(),w(l(x),{key:C,value:C,label:r.description},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),e.value?(p(),w(l(P),{key:0,loading:n.value,type:"danger",onClick:f},{default:o(()=>s[9]||(s[9]=[c(" 删除 ")])),_:1},8,["loading"])):O("",!0)]),a(l(j)),e.value?(p(),_(E,{key:0},[t.value?(p(),_(E,{key:0},[a(l(L),{"label-width":100,"label-position":"left"},{default:o(()=>[a(l(g),{label:"标题"},{default:o(()=>[a(l(U),{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=r=>v.value=r)},null,8,["modelValue"])]),_:1}),a(T,{label:"题目背景",modelValue:t.value.background,"onUpdate:modelValue":s[2]||(s[2]=r=>t.value.background=r)},null,8,["modelValue"]),a(T,{label:"题目描述",modelValue:t.value.legend,"onUpdate:modelValue":s[3]||(s[3]=r=>t.value.legend=r)},null,8,["modelValue"]),a(T,{label:"输入格式",modelValue:t.value.formatI,"onUpdate:modelValue":s[4]||(s[4]=r=>t.value.formatI=r)},null,8,["modelValue"]),a(T,{label:"输出格式",modelValue:t.value.formatO,"onUpdate:modelValue":s[5]||(s[5]=r=>t.value.formatO=r)},null,8,["modelValue"]),(p(!0),_(E,null,q(t.value.examples,(r,C)=>(p(),w(l(g),{key:C},{label:o(()=>[k("div",null,[c(W(`样例组 #${C+1}`)+" ",1),a(l(R),{icon:l(X),onClick:I=>A(C)},null,8,["icon","onClick"])])]),default:o(()=>[k("div",Pe,[a(l(U),{type:"textarea",modelValue:r.dataI,"onUpdate:modelValue":I=>r.dataI=I,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"]),a(l(U),{type:"textarea",modelValue:r.dataO,"onUpdate:modelValue":I=>r.dataO=I,autosize:{minRows:5,maxRows:10},resize:"none"},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128)),a(l(g),null,{default:o(()=>[a(l(P),{type:"primary",plain:"",onClick:s[6]||(s[6]=r=>t.value.examples.push({dataI:"",dataO:""}))},{default:o(()=>s[10]||(s[10]=[c("新建样例")])),_:1})]),_:1}),a(T,{label:"提示",modelValue:t.value.hint,"onUpdate:modelValue":s[7]||(s[7]=r=>t.value.hint=r)},null,8,["modelValue"])]),_:1}),a(l(P),{loading:n.value,type:"primary",onClick:V},{default:o(()=>s[11]||(s[11]=[c(" 保存 ")])),_:1},8,["loading"])],64)):(p(),_(E,{key:1},[a(l(L),null,{default:o(()=>[a(l(g),{label:"标题"},{default:o(()=>[a(l(U),{modelValue:v.value,"onUpdate:modelValue":s[8]||(s[8]=r=>v.value=r)},null,8,["modelValue"])]),_:1})]),_:1}),a(l(P),{type:"primary",onClick:b},{default:o(()=>s[12]||(s[12]=[c(" 创建 ")])),_:1})],64))],64)):O("",!0)]))}}),De=S(Te,[["__scopeId","data-v-901a696c"]]),Me={class:"basic-container"},Ie=D({__name:"ProblemEditBasic",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const{difficulties:i}=Z().config,u=y(!1),e=B(d,"modelValue");async function t(){u.value=!0;try{await G({problem:e.value})}finally{u.value=!1}}return(v,n)=>{const b=$("el-button");return p(),_("div",Me,[a(l(L),{modelValue:e.value,"onUpdate:modelValue":n[5]||(n[5]=f=>e.value=f),style:{"max-width":"200px"}},{default:o(()=>[a(l(g),{label:"时间限制"},{default:o(()=>[a(l(U),{modelValue:e.value.limitTime,"onUpdate:modelValue":n[0]||(n[0]=f=>e.value.limitTime=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"空间限制"},{default:o(()=>[a(l(U),{modelValue:e.value.limitMemory,"onUpdate:modelValue":n[1]||(n[1]=f=>e.value.limitMemory=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"可见状态"},{default:o(()=>[a(l(F),{modelValue:e.value.status,"onUpdate:modelValue":n[2]||(n[2]=f=>e.value.status=f)},{default:o(()=>[a(l(x),{value:"public",label:"公开"}),a(l(x),{value:"contest",label:"比赛"}),a(l(x),{value:"private",label:"隐藏"})]),_:1},8,["modelValue"])]),_:1}),a(l(g),{label:"题目类型"},{default:o(()=>[a(l(F),{modelValue:e.value.type,"onUpdate:modelValue":n[3]||(n[3]=f=>e.value.type=f)},{default:o(()=>[a(l(x),{value:"traditional",label:"传统"}),a(l(x),{value:"interactive",label:"交互"})]),_:1},8,["modelValue"])]),_:1}),a(l(g),{label:"题目难度"},{default:o(()=>[a(l(U),{modelValue:e.value.difficulty,"onUpdate:modelValue":n[4]||(n[4]=f=>e.value.difficulty=f),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),a(l(g),{label:"标签设置"})]),_:1},8,["modelValue"]),a(b,{loading:u.value,type:"primary",onClick:t},{default:o(()=>n[6]||(n[6]=[c(" 保存 ")])),_:1},8,["loading"])])}}}),$e=S(Ie,[["__scopeId","data-v-b39b7d1a"]]),Be={class:"testdata-container"},Se={class:"data-actions"},Ae=D({__name:"ProblemEditTestdata",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(d){const i=te(),u=B(d,"modelValue"),e=y(!1),t=y(!1);y(null),oe(()=>({Authorization:`Bearer ${i.currentToken}`}));const v=V=>{const m=V.type==="application/zip"||V.name.endsWith(".zip"),A=V.size/1024/1024<50;return m?A?!0:(N.error("数据包大小不能超过 50MB！"),!1):(N.error("数据包必须是 ZIP 格式！"),!1)},n=async V=>{const m={file:V.file,problem:u.value.id};await we(m)},b=async()=>{e.value=!0;try{const V=await ge({problem:u.value.id});V.url&&window.open(V.url,"_blank")}finally{e.value=!1}},f=async()=>{t.value=!0;try{await ke({problem:u.value.id})}finally{t.value=!1}};return(V,m)=>(p(),_("div",Be,[a(l(ne),{class:"upload-testdata",drag:"",limit:1,"before-upload":v,"auto-upload":!0,"http-request":n},{tip:o(()=>m[0]||(m[0]=[k("div",{class:"el-upload__tip"},"数据包应为zip格式，大小不超过200MB",-1)])),default:o(()=>[a(l(R),{icon:l(ue),size:"2x"},null,8,["icon"]),m[1]||(m[1]=k("div",{class:"el-upload__text"},[c("将数据包拖拽至此处，或者"),k("em",null,"点击上传")],-1))]),_:1}),a(l(j)),k("div",Se,[a(l(P),{type:"primary",loading:e.value,onClick:b},{default:o(()=>m[2]||(m[2]=[c(" 下载当前数据包 ")])),_:1},8,["loading"]),a(l(P),{type:"danger",loading:t.value,onClick:f},{default:o(()=>m[3]||(m[3]=[c(" 删除数据包 ")])),_:1},8,["loading"])]),a(l(de),{title:"配置文件说明",type:"info",closable:!1,description:"配置文件为YAML格式，用于定义测试数据的评分规则、时间限制等。",class:"mb-4"})]))}}),ze=S(Ae,[["__scopeId","data-v-c5a606fc"]]),Oe={key:0,style:{height:"200px"}},qe=D({__name:"ViewProblemEdit",props:{pid_str:{}},setup(d){const i=y("basic"),u=d,e=y(null),t=y(!1);async function v(){e.value=null,u.pid_str?(t.value=!0,await re({problem:parseInt(u.pid_str)}).then(n=>{e.value=n.problem}).finally(()=>{t.value=!1})):e.value={id:0,type:"traditional",statements:{},status:"private",limitTime:1e3,limitMemory:1e3,countCorrect:0,countTotal:0,difficulty:0,provider:0,tags:[],title:{},hasTestdata:!1,hasConfig:!1,updatedAt:new Date,createdAt:new Date,deletedAt:new Date}}return se(()=>{v()}),(n,b)=>{const f=$("el-empty"),V=me("loading");return p(),w(ie,{bread:[{label:"Reisen Online Judge",to:{name:"home"}},{label:"题目列表",to:{name:"problem-list"}},{label:`#${u.pid_str}`,to:{name:"problem-detail",params:{pid_str:u.pid_str}}},{label:"题目编辑"}]},{default:o(()=>[a(l(pe),null,{default:o(()=>[e.value?(p(),w(l(ve),{key:0,modelValue:i.value,"onUpdate:modelValue":b[3]||(b[3]=m=>i.value=m)},{default:o(()=>[a(l(z),{label:"基本信息",name:"basic"},{default:o(()=>[a($e,{modelValue:e.value,"onUpdate:modelValue":b[0]||(b[0]=m=>e.value=m)},null,8,["modelValue"])]),_:1}),a(l(z),{label:"题面编辑",name:"statement"},{default:o(()=>[a(De,{modelValue:e.value,"onUpdate:modelValue":b[1]||(b[1]=m=>e.value=m)},null,8,["modelValue"])]),_:1}),a(l(z),{label:"数据上传",name:"testdata"},{default:o(()=>[a(ze,{modelValue:e.value,"onUpdate:modelValue":b[2]||(b[2]=m=>e.value=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])):(p(),_(E,{key:1},[t.value?fe((p(),_("div",Oe,null,512)),[[V,!0]]):(p(),w(f,{key:1,description:"暂无数据"}))],64))]),_:1})]),_:1},8,["bread"])}}});export{qe as default};
